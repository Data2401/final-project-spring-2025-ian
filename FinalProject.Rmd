---
title: "Final Project"
author: "Adam Guenoun, Indira Martinez, Nicholas Solis"
output:
  slidy_presentation:
    highlight: kate
  powerpoint_presentation: default
---

### Introduction:

  Within this analysis, we'll investigate factors correlated to diabetes. With a data set of 100,000 people, this investigation allows us to display relations between ages, HbA1c levels, smoking history, and glucose levels. With a wide range of data points, we begin to question if there are trends within this data that match our general understanding of diabetes. Our goal is to asses which of the 9 variables play a stronger role to the development of diabetes and if we can prove trends to better support our assumptions of this data. Through data visualization, chart analysis, and numerical analysis we will be able to present this data to convicne a general audience of the important factors that contribute to diabteic trends. 


```{r, message=FALSE, warning=FALSE}
library(tidyverse) ## Loaded for dplyr
library(ggplot2) ## Loaded for plotting
library(plotly) ## Loaded for interactive plots
library(readr) ## Loaded to read in data
library(knitr) ## Loaded to compute and display data
library(scales) ## Loaded to scale data 
```

```{r Loading in Data, include=FALSE}
library(readr)
diabetes_dataset <- read_csv("diabetes_prediction_dataset.csv")
#View(diabetes_dataset)
```

## Diabetes Dataset

```{r, echo=FALSE,fig.width=4, fig.height=4 }
library(knitr)
#diabetes_dataset
kable(head(diabetes_dataset, 6), caption = "100,000 × 9 (first 6 rows)")
```

---

### Male vs. Female Blood Sugar Levels (HbA1c) Plot

For this part we will focus only on the HbA1c levels for males and females.

- Slightly higher diabetes rates among males by a count of 2,876.
- More females fall into the normal blood sugar category compared to males by a count of 7,134.
- Prediabetes in both genders are nearly identical , which suggests that prediabetes affect both genders at nearly the same rate.

Overall, blood sugar regulation patterns appear balanced between both genders.


```{r, echo=FALSE, fig.width=8, fig.height=6, fig.align="center"}
library(dplyr)
library(ggplot2)
library(plotly)
library(knitr) 

# select, filter, and mutate the columns I want to work with 

mut_diabdat_for_BSL <- diabetes_dataset %>%
  select(gender, diabetes, HbA1c_level) %>%
  filter(gender != "Other") %>%       # we want to focus on male and female only
  mutate(HbA1c_category = case_when(  # categorize diabetes status based on BSL
    HbA1c_level < 5.7 ~ "Normal < 5.7%",
    HbA1c_level >= 5.7 & HbA1c_level <= 6.4 ~ "Prediabetic 5.7% - 6.4%",
    HbA1c_level >= 6.5 ~ "Diabetic ≥ 6.5%",
    TRUE ~ NA_character_
  ))

kable(head(mut_diabdat_for_BSL, 5), caption = "99,982 x 4 (first 5 rows)")

# count, group_by, and mutate to obtain the number and percentage for each diabetic category for M and F

get_perc_count <- mut_diabdat_for_BSL %>% 
  count(gender, HbA1c_category) %>%  # new count col of the number of people within each category for M and F
  group_by(gender) %>%   # group by gender
  mutate(percent = n / sum(n) * 100) # get percentage of population within each diabetic category

# create my barplot, add x and y labels as well as color and text details. 
get_perc_count_plotly <- ggplot(get_perc_count, aes(x = gender, y = n, fill = HbA1c_category)) +
  geom_bar(stat = "identity", position = "fill", color = "black", linewidth = 0.1, alpha = 0.5) + 
  geom_text(aes(label = paste0(n, " (", round(percent, 1), "%)")),
            position = position_fill(vjust = 0.5), size = 3) +
  scale_fill_manual(values = c("Normal < 5.7%" = "cornsilk2", 
                               "Prediabetic 5.7% - 6.4%" = "darkkhaki", 
                               "Diabetic ≥ 6.5%" = "darkgoldenrod4")) +
  labs(title = "Male vs. Female Blood Sugar Levels (HbA1c)", 
       x = "Gender", y = "Proportion", fill = "HbA1c Category") +
  theme_classic() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(
    plot.title = element_text(size = 13),
    axis.text = element_text(size = 11),
  )

# here I make the bar plot interactive using ggplotly

ggplotly(get_perc_count_plotly)

kable(head(get_perc_count, 5), caption = "6 x 4 (first 5 rows)")
```

---

### Age Distribution in Diabetes, Heart Disease, and Hypertension Plot


```{r,echo=FALSE,fig.width=9, fig.height=5}
library(dplyr)
library(ggplot2)
library(plotly)
library(knitr) 

# show a density plot to display age distribution based on diabetes and heart disease
# I create 2 new variables based on my original data set, I select and filter the columns I want to work with

DHH_only <- diabetes_dataset %>% 
  select(age, diabetes, heart_disease, hypertension) %>%  
  filter(age >= 2, diabetes == 1, heart_disease == 1, hypertension == 1) %>%
  mutate(group = "Diabetes, H.D, and Hyp.")

kable(head(DHH_only, 5), caption = "358 x 5 (first 5 rows)")

No_DHH_only <- diabetes_dataset %>%
  select(age,heart_disease, diabetes, hypertension) %>%
  filter(age >= 2, diabetes == 0, heart_disease == 0, hypertension ==0) %>%
  mutate(group = "Free of Diabetes, H.D, and Hyp.")

kable(head(No_DHH_only, 5), caption = "81,885 x 5 (first 5 rows)")

# create the density plot, I name my x and y labels, title, color, fill, and plot size details
interactive_DHH <- ggplot() +
  geom_density(data = DHH_only, aes(x = age, fill = group), alpha = 0.5) +  # Diabetes cases
  geom_density(data = No_DHH_only , aes(x = age, fill = group), alpha = 0.5) +
  labs(title = "Age Distribution: Diabetes vs. Heart Disease",
       x = "Age",
       y = "Density") +
  scale_x_continuous(breaks = seq(2, 80, by = 6)) +
  scale_fill_manual(values = c("Diabetes, H.D, and Hyp." = "#660033",
                               "Free of Diabetes, H.D, and Hyp." = "#66CCFF")) +  # Custom colors
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(
    plot.title = element_text(size = 13),
    axis.text = element_text(size = 11),
  )

# here I make the bar plot interactive using ggplotly

ggplotly(interactive_DHH)
```

---

### BMI Distribution by Hypertension Status Plot


Shows the distribution of BMI values based on hypertension status. A violin plot is great for visualizing the distribution and density of BMI across hypertension categories,

Shape and width: The width of each "violin" represents the density of BMI values at different levels. Wider sections mean more individuals have that BMI, while narrower sections indicate fewer people at those values.

Comparison of distributions: The blue violin represents people without hypertension (hypertension = 0), while the red violin represents those with hypertension (hypertension = 1). By comparing them, you can see how BMI differs between these groups.

The horizontal line around 25 BMI: This marks the median BMI for each group. Since both violins have a horizontal line in roughly the same position, it suggests that the median BMI is around 25 for both hypertensive and non-hypertensive individuals.

Density trends: If the violins have different thicknesses in certain BMI ranges, it tells you which BMI values are more or less common in each group. People with hypertension seem to have a higher BMI overall, but both groups share a similar median.

The distribution shape is different—for example, if one violin is wider at higher BMI values, it suggests that hypertension is more common among individuals with higher BMI.

Outliers or extreme values might appear as small bulges or extended tails at the ends of the violins, showing individuals with very high or low BMI.

```{r, echo=FALSE,fig.width=7, fig.height=6, fig.align="center"}
library(dplyr)
library(ggplot2)
library(plotly)
library(knitr) 

kable(head(diabetes_dataset, 5), caption = "10,000 x 9 (first 5 rows)") # display the diabetes_dataset table

overall_median_bmi <- median(diabetes_dataset$bmi, na.rm = TRUE) # new variable for the median of bmi to obtain horizontal red line

#create a violin plot, hypertension is selected as our x variable and bmi as our y variable
BMI_distribution <- ggplot(diabetes_dataset, aes(x = factor(hypertension), y = bmi, fill = factor(hypertension))) + # use factor so that hypertension can be treated as a factor
  geom_violin(alpha = 0.6) +
  geom_hline(yintercept = overall_median_bmi, linetype = "solid", color = "red", linewidth = 0.3) +
  scale_fill_manual(values = c("azure3", "#CC6600")) +
   scale_y_continuous(breaks = seq(10.01, 95.69, by = 5)) +
  labs(title = "BMI Distribution by Hypertension Status",
       x = "Hypertension Status (0 = No, 1 = Yes)",
       y = "BMI",
       fill = "Hypertension") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(
    plot.title = element_text(size = 13),
    axis.text = element_text(size = 11),
  )

# make our plot interactive with ggplotly
ggplotly(BMI_distribution)
```

The graph below is separated by whether or not a person has hypertension. With the comparison of BMI as the range, it's seen that majority of people with and without hypertension lie within a BMI range of 25-29. Notice that for people with hypertension, the desnity population above the red line is greater than that of people without hypertension; indicating that there's a larger of population of people with hypertension that have a larger BMI  

---

### Blood Glucose Levels by Diabetes Status (age 3-80) Plot

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=7, fig.height=6}
library(dplyr)
library(ggplot2)
library(plotly)
library(knitr) 

# these are the variables I worked with to create this table
table_diabetes_no_diabetes <- diabetes_dataset %>%
  select(age,diabetes, blood_glucose_level) %>%
  filter(age >= 3) %>% 
  mutate(diabetes = factor(diabetes, levels = c(0, 1), labels = c("No Diabetes", "Diabetes")))

# here I show the table
kable(head(table_diabetes_no_diabetes, 5), caption = "96,713 x 3 (first 5 rows)")

diabetes_and_no_diabetes_plot <- diabetes_dataset %>%
  select(blood_glucose_level,diabetes, age) %>%
  filter(age >= 3) %>% 
  mutate(diabetes = factor(diabetes, levels = c(0, 1), labels = c("No Diabetes", "Diabetes"))) %>% 
  ggplot(aes(x = diabetes, y = blood_glucose_level, fill = diabetes)) +
  geom_boxplot(alpha = 0.5) +
  labs(title = "Blood Glucose Levels by Diabetes Status (age 3-80)",
       x = "Diabetes Status",
       y = "Blood Glucose Level") +
  scale_fill_manual(values = c("Diabetes" = "#CC3300", "No Diabetes" = "#99CCFF")) +
  labs(fill = "Status") +
  scale_y_continuous(breaks = seq(80, 300, by = 20)) +
  geom_hline(yintercept = c(120, 140), linetype = "solid", color = "#0033FF", size = 0.2) +
  geom_hline(yintercept = c(180, 250), linetype = "solid", color = "#CC3300", size = 0.3) +  # Mark High Range
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5))+
  theme(
    plot.title = element_text(size = 13),
    axis.text = element_text(size = 11),
  )

# make our plot interactive with ggplotly
ggplotly(diabetes_and_no_diabetes_plot)
```

---

### BMI vs. Age Across Diabetes & Heart Disease Plot

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.width=10, fig.height=6, fig.align="center"}
library(dplyr)
library(ggplot2)
library(knitr) 

#diabetes_dataset

# here I create 2 variables that represent the data frames I'll be working on 
diabetes_only <- diabetes_dataset %>%
  select(age, bmi, diabetes) %>%
  filter(age >= 2, diabetes == 1) %>%
  mutate(condition = "Diabetes Only")

# here is a display the diabetes_only data frame
kable(head(diabetes_only, 5), caption = "8,500 x 4 (first 5 rows)")

heart_disease_only <- diabetes_dataset %>%
  select(age, bmi, heart_disease) %>%
  filter(age >= 2, heart_disease == 1) %>%
  mutate(condition = "Heart Disease Only")

# here is a display the heart_disease_only data frame
kable(head(heart_disease_only, 5), caption = "3,942 x 4 (first 5 rows)")

# next, I combine the 2 data frames to create a scatter plot
combined_dataaa <- bind_rows(diabetes_only, heart_disease_only)

# here I want to show that there is a common BMI between individuals with diabetes only and individuals with heart disease only, I will show this by drawing a red horizontal line across the plot
common_bmi <- combined_dataaa %>%
  count(bmi) %>% # count bmi
  arrange(desc(n))  # sort by highest count

most_common_bmi <- common_bmi$bmi[1] # extract the most frequent bmi to mark a red horizontal line

ggplot(combined_dataaa) +
  geom_point(aes(x = age, y = bmi, color = condition), alpha = 0.3) +  # Scatter plot with BMI
  geom_jitter(aes(x = age, y = bmi, color = condition), width = 0.1, height = 0.1, alpha = 0.3) +
 geom_hline(aes(yintercept = 27.32, color = "Common BMI = 27.32"), linetype = "solid", size = 0.3)  +  # horizontal line marking common BMI
  scale_color_manual(
    values = c("Diabetes Only" = "cornflowerblue", 
               "Heart Disease Only" = "darkorchid4", 
               "Common BMI = 27.32" = "red"),
    labels = c("Common BMI = 27.32", "Diabetes Only", "Heart Disease Only")) +
  scale_x_continuous(breaks = seq(0, 80, by = 5)) + 
  scale_y_continuous(breaks = seq(10.01, 95.69, by = 10)) +
  labs(title = "BMI vs. Age Across Diabetes & Heart Disease",
       x = "Age",
       y = "BMI",
       color = "Condition") +
  theme_bw() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(
    axis.text = element_text(size = 11),
    legend.text = element_text(size = 11),
    plot.title = element_text(size = 13)
  )

```

---

### A relation to BMI and Heart Disease
Each person within this scale has heart disease. Here a comparison is made between declared underweight and overweight people, grouped by sex, based on a BMI scale. There's a significant increase in population percentage for those who are considered overweight and that have heart disease. With visual aid, it can be concluded that as weight increases, chances of heart disease will increase.

```{r, echo=FALSE}
library(ggplot2)
library(dplyr)


bmi_heart_gender <- diabetes_dataset %>%
  filter(heart_disease == 1) %>%
  mutate(
    bmi_category = case_when(
      bmi <= 19 ~ "Underweight",
      bmi >= 30 ~ "Overweight",
      TRUE      ~ NA_character_
    )
  ) %>%
  filter(!is.na(bmi_category)) %>%
  group_by(gender, bmi_category) %>%
  summarise(count = n(), .groups = 'drop') %>%
  group_by(gender) %>%
  mutate(percentage = round(100 * count / sum(count), 1)) %>%
  ungroup()

bmi_heart_gender$bmi_category <- factor(bmi_heart_gender$bmi_category,
                                        levels = c("Underweight", "Overweight"))


max_ct <- max(bmi_heart_gender$count)
y_breaks <- pretty(c(0, max_ct), n = 10)    # ~10 ticks

ggplot(bmi_heart_gender,
       aes(x = bmi_category,
           y = count,
           group = gender,
           color = gender)) +
  geom_line(position = position_dodge(width = 0.5), linewidth = 1) +
  geom_point(position = position_dodge(width = 0.5), size = 5) +
  geom_text(aes(label = paste0(count, " (", percentage, "%)")),
            vjust = -1,
            position = position_dodge(width = 0.5)) +
  scale_y_continuous(
    breaks = y_breaks,
    expand = expansion(mult = c(0, .05))   # so labels don’t get clipped
  ) +
  labs(
    title = "Heart Disease Cases by Gender and BMI Category",
    x     = "BMI Category",
    y     = "Count of People with Heart Disease",
    color = "Gender"
  ) +
  theme_minimal()

```

---

### An excpetion?

The data here is heavily dependent on BMI scale. It is important to note that BMI is not really a great determination for those who have diabetes, but there is a general trend within the data that people who have a BMI over 30 are more likely to be diabetic. 


```{r, echo=FALSE}
library(dplyr)
library(ggplot2)

 male_data = diabetes_dataset %>% filter(gender == "Male")
 female_data = diabetes_dataset %>% filter(gender == "Female")
# Summarise men
men_summary <- male_data %>%
  summarise(
    count = sum(bmi >= 30 & diabetes == 0),
    total = n()
  ) %>%
  mutate(
    sex        = "Men",
    percent    = count / total * 100
  )
# Summarise women
women_summary <- female_data %>%
  summarise(
    count = sum(bmi >= 30 & diabetes == 0),
    total = n()
  ) %>%
  mutate(
    sex        = "Women",
    percent    = count / total * 100
  )
# Combine into one data frame
men_women_df = bind_rows(men_summary, women_summary)
#plot
ggplot(men_women_df, aes(x = sex, y = count, fill = sex)) +
  geom_col(width = 0.6) +
  geom_text(aes(label = sprintf("%d (%.1f%%)", count, percent)),
            vjust = -0.5, size = 4) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.1))) +
  labs(
    title = "Count of Overweight (BMI ≥ 30) without diabetes, by Sex",
    x     = NULL,
    y     = "Number of Individuals",
    fill  = NULL
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")
```

---
### A relation to hypertension?

This depicts the different categories of HbA1c levels and their relation to patients hypertension status
```{r, echo=FALSE}
library(dplyr)
library(ggplot2)
library(scales)
#creating variables and assigning to dataset
df_summary <- diabetes_dataset %>%
  mutate(
    HbA1c_cat = case_when(
      HbA1c_level < 5.7                      ~ "< 5.7 (non diabetic)",
      HbA1c_level >= 5.7 & HbA1c_level < 6.5 ~ "5.7–6.4 (prediabetic)",
      HbA1c_level >= 6.5                    ~ "≥ 6.5 (diabetic)"
    ),
    hypertension = factor(hypertension, levels = c(0,1), #creating hypertension to a factor
                          labels = c("No", "Yes"))
  ) %>%
  group_by(HbA1c_cat, hypertension) %>%
  summarise(n = n(), .groups = "drop_last") %>%
  mutate(percent = n / sum(n))  # auto‑groups by HbA1c_cat
# plot
ggplot(df_summary, aes(x = HbA1c_cat,
                       y = percent,
                       fill = factor(hypertension))) +
  geom_col(position = "stack") +
  geom_text(aes(label = scales::percent(percent, 1)),
            position = position_stack(vjust = 0.5)) +
  scale_y_continuous(labels = scales::percent_format()) +
  scale_fill_discrete(name = "Hypertension",
                      labels = c("No", "Yes")) +
  labs(
    title = "Hypertension Status by HbA1c Category",
    x     = "HbA1c Category",
    y     = "Percent within Category"
  ) +
  theme_light()

```

___
### Diabetic range for men

This graph shows the population density of men based on diabetes status, based on age range
```{r, echo=FALSE}
library(ggplot2)
# assigning dataset
df_male <- diabetes_dataset %>% 
  filter(gender == "Male") %>% 
  mutate(diabetes = factor(diabetes, #making diabetes status as a factor
                           levels = c(0,1),
                           labels = c("Non‑diabetic","Diabetic")))
# ggplot code
male_diabetic_dens = ggplot(df_male, aes(x = age, fill = diabetes)) +
  geom_density(alpha = 0.5) +
  scale_fill_manual(
    name   = "Diabetes status",
    values = c("Non‑diabetic" = "lightpink", 
               "Diabetic"     = "#301934")
  ) +
  labs(
    title = "Age Distribution in Male Subjects",
    x     = "Age",
    y     = "Density"
  ) +
  theme_minimal()

ggplotly(male_diabetic_dens)
```

___

### Diabetic range for women

This graph shows the population density of women based on diabetes status, based on age range
```{r, echo=FALSE}
library(ggplot2)
# assigning dataset
df_female <- diabetes_dataset %>% 
  filter(gender == "Female") %>% 
  mutate(diabetes = factor(diabetes, #making diabetes status as a factor
                           levels = c(0,1),
                           labels = c("Non‑diabetic","Diabetic")))
# ggplot code
 female_diabetic_dens = ggplot(df_female, aes(x = age, fill = diabetes)) +
  geom_density(alpha = 0.5) +
  scale_fill_manual(
    name   = "Diabetes status",
    values = c("Non‑diabetic" = "lightpink", 
               "Diabetic"     = "#309")
  ) +
  labs(
    title = "Age Distribution in Female Subjects",
    x     = "Age",
    y     = "Density"
  ) +
  theme_minimal()

 ggplotly(female_diabetic_dens)

```

---





















