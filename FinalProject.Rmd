---
title: "FinalProject"
output: html_document
date: "2025-04-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(plotly)

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r Loading in Data}
library(readr)
diabetes_dataset <- read_csv("diabetes_prediction_dataset.csv")


view(diabetes_dataset)
```

## Including Plots

You can also embed plots, for example:

```{r}
diabetes_dataset
# male datatset
male_data = diabetes_dataset %>% filter(gender == "Male")
# female dataset
female_data = diabetes_dataset %>% filter(gender == "Female")
female_data

# males and females within original dataset that have a "normal" A1C

female_data %>% filter(HbA1c_level <= 5.7) %>% tally()
male_data %>% filter(HbA1c_level <= 5.7) %>% tally()

# count of people (male and female) with both heart disease and diabetes
diabetes_dataset %>% filter(diabetes == 1, heart_disease == 1) # this is saying how many rows are in the data group and tally ***
# count of overweight people based on bmi who have heart disease
diabetes_dataset %>% group_by(bmi >= 30) %>% filter(heart_disease == 1)
diabetes_dataset %>% group_by(bmi >= 30) %>% filter(heart_disease == 1) 


# "obese men" with bmi higher than 30 and that have diabetes (tally on second line)
male_data %>% filter(bmi >= 30, diabetes == 1)
male_data %>% filter(bmi >= 30, diabetes == 1) %>% tally()
# "obese women" with bmi higher than 30 and that have diabetes (tally on second line)
female_data %>% filter(bmi >= 30, diabetes == 1)
female_data %>% filter(bmi >= 30, diabetes == 1) %>% tally() # grouped by gender ***
# "underweight men"  with bmi lower than 19 and that have diabetes (tally on second line)
male_data %>% filter(bmi <= 19, diabetes == 1)
male_data %>% filter(bmi <= 19, diabetes == 1) %>% tally()
# "underweight women"  with bmi lower than 19 and that have diabetes (tally on second line)
female_data %>% filter(bmi <= 19, diabetes == 1)
female_data %>% filter(bmi <= 19, diabetes == 1) %>% tally()
# the assumption is that overweight people are more likely to have diabetes. Below is the code and tally of MEN who are overweight in terms of bmi and DONT have diabetes
male_data %>% filter(bmi >= 30, diabetes == 0)
male_data %>% filter(bmi >= 30, diabetes == 0) %>% tally()
# the assumption is that overweight people are more likely to have diabetes. Below is the code and tally of WOMEN who are overweight in terms of bmi and DONT have diabetes
female_data %>% filter(bmi >= 30, diabetes == 0)
female_data %>% filter(bmi >= 30, diabetes == 0) %>% tally()
```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

In this section we want to display a stack bar showing how HbA1c levels (average blood sugar levels) can classify Males and Females in different categories such as Normal, Prediabetes, and Diabetes. From this plot we gain insight on how the distribution of Normal, Prediabetes, and Diabetes varies between both genders.

First we load our libraries such as dplyr for data manipulation, ggplot2 for data visualization, and plotly to make our plot interactive. Then we we display our original dataset. 


From our original data set we create a new dataset called HbA1c_by_gender. For our new dataset we want to keep only the Male and Female gender and exclude Other, the way to do this is by filtering our gender column to not equal to 'Other'. We also create a new variable called HbA1c_category with the use of our mutate function. We use the case_when function to classify our HbA1c_level column and return different categories such as 'Normal', 'Prediabetes', and 'Diabetes'.

Then we print out our mutated dataset to make a comparison of the original.

In the next section we want our stack bar to follow a certain order, we want Normal at the top, Prediabetes at the middle, and Diabetes at the bottom. To do this we will mutate our HbA1c_category column to an ordered categorical variable with the use of the factor function, the levels argument helps to set the order we want.


Next, we will plot a stack bar using ggplot. Before that we will change the name of our data set to 'Interactive_mode' that way we can easily incorporate our data set to ggplotly. The scale_fill_manual function is used to manually assign colors to the different categories.

Lastly, with the use of plotly we transform our plot into an interactive plot. When approaching the table we are able to see the count, gender, and HbA1c_category for any of the stacked bars.

```{r}
library(dplyr)
library(ggplot2)
library(plotly)

diabetes_dataset

HbA1c_by_gender <- diabetes_dataset %>% filter(gender != 'Other') %>% 
  mutate(HbA1c_category = case_when(
    HbA1c_level < 5.7 ~ "Normal < 5.7%",
    HbA1c_level >= 5.7 & HbA1c_level < 6.5 ~ "Prediabetes 5.7% - 6.4%",
    HbA1c_level >= 6.5 ~ "Diabetes ≥ 6.5%",
    TRUE ~ NA_character_  # handles unexpected cases that don’t match the defined conditions keeping missing values as NA
    ))

HbA1c_by_gender

HbA1c_by_gender <- HbA1c_by_gender %>%
  mutate(HbA1c_category = factor(HbA1c_category, levels = c("Normal < 5.7%", "Prediabetes 5.7% - 6.4%", "Diabetes ≥ 6.5%")))

interactive_mode <- HbA1c_by_gender %>% ggplot(aes(x = gender, fill = HbA1c_category)) +
  geom_bar(position = "stack") +
  scale_fill_manual(values = c("Normal < 5.7%" = "cornsilk2", "Prediabetes 5.7% - 6.4%" = "darkkhaki", "Diabetes ≥ 6.5%" = "darkgoldenrod")) +
  labs(title = "Male vs. Female HbA1c Levels",
       x = "Gender",
       y = "Count",
       fill = "HbA1c Category") +
  theme_classic()  +
  theme(plot.title = element_text(hjust = 0.5)) # this code adjusts the tittle to the middle

ggplotly(interactive_mode)

library(ggplot2)

ggplot(diabetes_dataset, aes(x = bmi, fill = factor(hypertension))) +
  geom_density(alpha = 0.7) +
  scale_fill_manual(values = c("blue", "red"), labels = c("No Hypertension", "Hypertension")) +
  labs(title = "BMI Distribution by Hypertension Status",
       x = "BMI",
       y = "Density",
       fill = "Hypertension") +
  theme_minimal()

```

Here I'll leave extra info for you guys regarding the gender column of the original data set
```{r}
diabetes_dataset %>% filter(gender == 'Female') %>% tally # 58,552 we have 17,122 more females than males in this data set
diabetes_dataset %>% filter(gender == 'Male') %>% tally   # 41,430	
diabetes_dataset %>% filter(gender == 'Other') %>% tally  # 18	
```
```{r}
#BMI (Body Mass Index) is closely related to hypertension. Studies show that obesity is a major risk factor for high blood pressure, with around 65% to 78% of primary hypertension cases being linked to excess weigh

ggplot(diabetes_dataset, aes(x = hypertension, fill = bmi)) +
  geom_density(alpha = 0.5) +
  labs(title = "BMI Distribution by Hypertension Status", x = "BMI", y = "Hypertension")

diabetes_dataset %>% select(hypertension) %>%  filter(hypertension != 1 & 0)

hypertension_vs_bmi <- HbA1c_by_gender %>%
  mutate(hypertension_vs_bmi = factor(hypertension, levels = c("yes", "no")))
hypertension_vs_bmi
ggplot(hypertension_vs_bmi) + geom_density(aes(x = bmi , color = hypertension),alpha = .6)
```



# Smokers go brrr
In the smoking data there are 6 unique values

   1) Never: Has Never smoked
   2) Not current: Has smoked but is not currently smoking
   3) Former: Has quit smoking (abstained for longer than)
   4) Current: Is currently a smoker
   5) Ever: Has ever smoked regardless of current smoking status
   6) No Info: No smoking history information available
   
The total amount of people who fall into each category is as follows;

   1) Never: 35095
   2) Not current: 6447
   3) Former: 9352
   4) Current: 9286
   5) Ever: 4004
   6) No Info: 35816
   
There is quite a sizable amount of people in the No info category.

The total number of people in the dataset is `r nrow(diabetes_dataset)`. 
To help clean up the data, we can filter 'No Info' people out. When we do that we get `r nrow(diabetes_dataset %>% filter(smoking_history != 'No Info'))`.
```{r Cleaning smoking data}

# Figure out the unique categories of smoking history 
unique(diabetes_dataset$smoking_history)

# Count amount of people who belong to each unique category
diabetes_dataset %>% group_by(smoking_history) %>% summarise(total_people = n())

smoking_diabetes_dataset <- diabetes_dataset %>% 
  filter(smoking_history != 'No Info') %>%  
  group_by(smoking_history, diabetes) %>%  
  summarise(total = n())
```
Now we can graph the relationship between

```{r Plotting data}

print('hello world')

```







